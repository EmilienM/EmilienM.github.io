<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Deploying OpenShift with an External Load-Balancer for your control plane | /home/emilien</title>
<meta name=keywords content><meta name=description content="This is my first post of a series which will cover how you can distribute your OpenShift cluster across multiple datacenter domains and increase
availability and performance of your control plane."><meta name=author content="Emilien Macchi"><link rel=canonical href=https://my1.fr/blog/openshift-external-load-balancer-control-plane-intro/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.e71504e55f7ea528719bee3e4c0297ec05b4a6bac6662de6744ed4dd503cf107.css integrity="sha256-5xUE5V9+pShxm+4+TAKX7AW0prrGZi3mdE7U3VA88Qc=" rel="preload stylesheet" as=style><link rel=icon href=https://my1.fr/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://my1.fr/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://my1.fr/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://my1.fr/favicons/apple-touch-icon.png><link rel=mask-icon href=https://my1.fr/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://my1.fr/blog/openshift-external-load-balancer-control-plane-intro/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="https://my1.fr/blog/openshift-external-load-balancer-control-plane-intro/"><meta property="og:site_name" content="/home/emilien"><meta property="og:title" content="Deploying OpenShift with an External Load-Balancer for your control plane"><meta property="og:description" content="This is my first post of a series which will cover how you can distribute your OpenShift cluster across multiple datacenter domains and increase availability and performance of your control plane."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-17T00:00:00+00:00"><meta property="article:modified_time" content="2023-02-17T00:00:00+00:00"><meta property="og:image" content="https://my1.fr/images/external-lb.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://my1.fr/images/external-lb.png"><meta name=twitter:title content="Deploying OpenShift with an External Load-Balancer for your control plane"><meta name=twitter:description content="This is my first post of a series which will cover how you can distribute your OpenShift cluster across multiple datacenter domains and increase
availability and performance of your control plane."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://my1.fr/posts/"},{"@type":"ListItem","position":2,"name":"Deploying OpenShift with an External Load-Balancer for your control plane","item":"https://my1.fr/blog/openshift-external-load-balancer-control-plane-intro/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Deploying OpenShift with an External Load-Balancer for your control plane","name":"Deploying OpenShift with an External Load-Balancer for your control plane","description":"This is my first post of a series which will cover how you can distribute your OpenShift cluster across multiple datacenter domains and increase availability and performance of your control plane.\n","keywords":[],"articleBody":"This is my first post of a series which will cover how you can distribute your OpenShift cluster across multiple datacenter domains and increase availability and performance of your control plane.\nBackground Originally the on-premise OpenShift IPI architecture was designed to deploy an internal (called OpenShift Managed) load balancer based on HAproxy and Keepalived. However when you want to distribute your cluster across multiple failure domains, your control plane has to be deployable on multiple L2 networks, which are usually isolated per rack, and routed with protocols like BGP.\nStretched vs L3 networks A single stretched L2 network brings challenges:\nNetwork latency is not predictable Traffic bottlenecks L2 domain failures Network management complexity Smaller (L3 routed) networks however has these benefits:\nOptimize East-West traffic Low and predictable latency Easier to extend and manage Failure domain isolated to a network Non blocking network fabric OpenShift Managed Load-Balancer For on-prem platforms (VSphere, Baremetal, OpenStack, Ovirt and Nutanix), the control plane load balancer is based on HAproxy and Keepalived. It means that the control plane VIPs (for API \u0026 Ingress services) will be managed in Active/Passive mode. The Keepalived master (elected by VRRPv2) will host the VIPs and therefore all the API \u0026 Ingress traffic will always go through one node and then load-balanced across the control plane. This bottleneck has been an issue at large scale.\nAlso, Keepalived doesn’t deal with L3 routing, so if the VIPs aren’t within the same subnet as the L2 networks, the network fabric can’t know where the VIPs actually are.\nUser Managed Load-Balancer When we initially looked at the limitations of the OpenShift Managed Load-Balancer, we thought we would just add BGP to the OpenShift control plane, so the VIPs could be routed across the datacenter. You can have a look at this demo that shows how it would work. After the initial proposal which brought up a lot of good ideas, it was decided that for now we would rather try to externalize the Load-Balancer and let the customers dealing with it, rather than implementing something new in OpenShift (I’ll come back to it the wrap-up).\nIndeed, a lot of our customers already have (enterprise-grade) load balancers that they use for their workloads. Some of them want to re-use these appliances and manage the OpenShift control plane traffic with them.\nWe realized that some of them want BGP, some of them don’t. Some want to keep stretched L2 networks, some don’t. There were a lot of decisions we would make if we would have implemented BGP within the OpenShift control plane so we decided that for now we will allow to use an external (user-managed) load balancer, like it’s already the case for the workloads themselves (e.g. with MetalLB).\nMore details on the design can be found in this OpenShift enhancement.\nDeploy your own Load-Balancer I want to share how someone can deploy a load balancer that will be used by the OpenShift control plane. For that, I’ve decided to create an Ansible role named ansible-role-routed-lb.\nThis will deploy an advanced Load-Balancer capable of managing routed VIPs with FRR (using BGP) and load-balance traffic with HAproxy.\nThe role will do the following:\nIf BGP neighbors are provided in the config, it’ll deploy FRR and peer with your BGP neighbor(s). If the VIPs are created on the node, they’ll be routed in your infrastructure. Deploy HAproxy to load-balance and monitor your service. If the VIPs are provided in the config, they will be created if a minimum number of backend(s) are found healthy for a given service, and therefore routed in BGP if FRR is deployed. They will be removed if no backend was found healthy for a given service, therefore not routed in BGP if FRR is deployed So if you’re hosting multiple Load-Balancers, your OpenShift control plane traffic will be:\nrouted thanks to BGP if FRR is deployed load-balanced and high-availability at the VIP level thanks to BGP if FRR is deployed load-balanced between healthy backends thanks to HAproxy Let’s deploy it!\nIn this blog post, we won’t cover the Failure Domains yet, and will deploy OpenShift within a single Leaf. Therefore, we’ll deploy only one load balancer.\nCreate your Ansible inventory.yaml file:\n--- all: hosts: lb: ansible_host: 192.168.11.2 ansible_user: cloud-user ansible_become: true 192.168.11.2 is the IP address of the load balancer.\nCreate the Ansible playbook.yaml file:\n--- - hosts: lb vars: config: lb tasks: - name: Deploy the LBs include_role: name: emilienm.routed_lb Write the LB configs in Ansible vars.yaml:\n--- configs: lb: bgp_asn: 64998 bgp_neighbors: - ip: 192.168.11.1 password: f00barZ services: - name: api vips: - 192.168.100.240 min_backends: 1 healthcheck: \"httpchk GET /readyz HTTP/1.0\" balance: roundrobin frontend_port: 6443 haproxy_monitor_port: 8081 backend_opts: \"check check-ssl inter 1s fall 2 rise 3 verify none\" backend_port: 6443 backend_hosts: \u0026lb_hosts - name: rack1-10 ip: 192.168.11.10 - name: rack1-11 ip: 192.168.11.11 - name: rack1-12 ip: 192.168.11.12 - name: rack1-13 ip: 192.168.11.13 - name: rack1-14 ip: 192.168.11.14 - name: rack1-15 ip: 192.168.11.15 - name: rack1-16 ip: 192.168.11.16 - name: rack1-17 ip: 192.168.11.17 - name: rack1-18 ip: 192.168.11.18 - name: rack1-19 ip: 192.168.11.19 - name: rack1-20 ip: 192.168.11.20 - name: ingress_http vips: - 192.168.100.250 min_backends: 1 healthcheck: \"httpchk GET /healthz/ready HTTP/1.0\" frontend_port: 80 haproxy_monitor_port: 8082 balance: roundrobin backend_opts: \"check check-ssl port 1936 inter 1s fall 2 rise 3 verify none\" backend_port: 80 backend_hosts: *lb_hosts - name: ingress_https vips: - 192.168.100.250 min_backends: 1 healthcheck: \"httpchk GET /healthz/ready HTTP/1.0\" frontend_port: 443 haproxy_monitor_port: 8083 balance: roundrobin backend_opts: \"check check-ssl port 1936 inter 1s fall 2 rise 3 verify none\" backend_port: 443 backend_hosts: *lb_hosts - name: mcs vips: - 192.168.100.240 min_backends: 1 frontend_port: 22623 haproxy_monitor_port: 8084 balance: roundrobin backend_opts: \"check check-ssl inter 5s fall 2 rise 3 verify none\" backend_port: 22623 backend_hosts: *lb_hosts In this case, we deploy OpenShift on OpenStack which doesn’t support static IPs. Therefore, we have to put all the available IPs from the subnet used for the machines, in the HAproxy backends.\nInstall the role and the dependencies:\nansible-galaxy install emilienm.routed_lb,1.0.0 ansible-galaxy collection install ansible.posix ansible.utils Deploy the LBs:\nansible-playbook -i inventory.yaml -e \"@vars.yaml\" playbook.yaml Deploy OpenShift This feature will be available in the 4.13 release as TechPreview.\nHere is how you can simply enable it via the install-config.yaml:\napiVersion: v1 baseDomain: mydomain.test compute: - name: worker platform: openstack: type: m1.xlarge replicas: 3 controlPlane: name: master platform: openstack: type: m1.xlarge replicas: 3 metadata: name: mycluster networking: clusterNetwork: - cidr: 10.128.0.0/14 hostPrefix: 23 machineNetwork: - cidr: 192.168.11.0/24 - cidr: 192.168.100.0/24 platform: openstack: cloud: mycloud machinesSubnet: 8586bf1a-cc3c-4d40-bdf6-c243decc603a apiVIPs: - 192.168.100.240 ingressVIPs: - 192.168.100.250 loadBalancer: type: UserManaged featureSet: TechPreviewNoUpgrade You can also watch this demo which shows the outcome.\nKnown limitations Deploying OpenShift with static IPs for the machines is only supported on Baremetal platform for now but it’s in the roadmap to support it on VSphere and OpenStack as well. Changing the IP address for any OpenShift control plane VIP (API + Ingress) is currently not supported. So once the external LB and the OpenShift cluster is deployed, the VIPs can’t be changed. This is in our roadmap. Migrating an OpenShift cluster from the OpenShift managed LB to an external LB is currently not supported. It’s in our roadmap as well. Keep in mind that the feature will be TechPreview at first and once it has reached some maturity, we’ll promote it to GA.\nWrap-up Having the VIPs highly available, routed across multiple domains is only a first step into distributing the OpenShift control plane. In the future, we’ll discuss about how Failure Domains will be configured when deploying OpenShift on OpenStack. Note that this is already doable on Baremetal and Vsphere.\nWith this effort, our customers can now decide which Load-Balancer to use, and if they have some expertise in their appliance now they can use it for the OpenShift control plane.\nThe way we implemented it is flexible and will allow us to implement new load balancers in OpenShift if we want to in the future. The proof of concept done a few months ago with BGP in the control plane could be restored if there is growing interest.\nI hope you liked this article and stay tuned for the next ones!\n","wordCount":"1351","inLanguage":"en","image":"https://my1.fr/images/external-lb.png","datePublished":"2023-02-17T00:00:00Z","dateModified":"2023-02-17T00:00:00Z","author":{"@type":"Person","name":"Emilien Macchi"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://my1.fr/blog/openshift-external-load-balancer-control-plane-intro/"},"publisher":{"@type":"Organization","name":"/home/emilien","logo":{"@type":"ImageObject","url":"https://my1.fr/favicons/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://my1.fr/ accesskey=h title="Emilien Macchi (Alt + H)"><img src=https://my1.fr/images/em.png alt aria-label=logo height=35>Emilien Macchi</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://my1.fr/categories/ title=categories><span>categories</span></a></li><li><a href=https://my1.fr/search title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://my1.fr/about-me title="about me"><span>about me</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://my1.fr/>Home</a>&nbsp;»&nbsp;<a href=https://my1.fr/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Deploying OpenShift with an External Load-Balancer for your control plane</h1><div class=post-meta><span title='2023-02-17 00:00:00 +0000 UTC'>February 17, 2023</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;1351 words&nbsp;·&nbsp;Emilien Macchi</div></header><figure class=entry-cover><img loading=eager src=https://my1.fr/images/external-lb.png alt></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#background aria-label=Background>Background</a></li><li><a href=#stretched-vs-l3-networks aria-label="Stretched vs L3 networks">Stretched vs L3 networks</a></li><li><a href=#openshift-managed-load-balancer aria-label="OpenShift Managed Load-Balancer">OpenShift Managed Load-Balancer</a></li><li><a href=#user-managed-load-balancer aria-label="User Managed Load-Balancer">User Managed Load-Balancer</a></li><li><a href=#deploy-your-own-load-balancer aria-label="Deploy your own Load-Balancer">Deploy your own Load-Balancer</a></li><li><a href=#deploy-openshift aria-label="Deploy OpenShift">Deploy OpenShift</a></li><li><a href=#known-limitations aria-label="Known limitations">Known limitations</a></li><li><a href=#wrap-up aria-label=Wrap-up>Wrap-up</a></li></ul></div></details></div><div class=post-content><p>This is my first post of a series which will cover how you can distribute your OpenShift cluster across multiple datacenter domains and increase
availability and performance of your control plane.</p><h3 id=background>Background<a hidden class=anchor aria-hidden=true href=#background>#</a></h3><p>Originally the on-premise OpenShift IPI architecture was designed to deploy an internal (called OpenShift Managed) load balancer based on HAproxy and Keepalived.
However when you want to distribute your cluster across multiple <a href=https://github.com/openshift/enhancements/pull/1319>failure domains</a>, your
control plane has to be deployable on multiple L2 networks, which are usually isolated per rack, and routed with protocols like BGP.</p><h3 id=stretched-vs-l3-networks>Stretched vs L3 networks<a hidden class=anchor aria-hidden=true href=#stretched-vs-l3-networks>#</a></h3><p>A single stretched L2 network brings challenges:</p><ul><li>Network latency is not predictable</li><li>Traffic bottlenecks</li><li>L2 domain failures</li><li>Network management complexity</li></ul><p><img alt="Stretched architecture" loading=lazy src=/images/stretched.png></p><p>Smaller (L3 routed) networks however has these benefits:</p><ul><li>Optimize East-West traffic</li><li>Low and predictable latency</li><li>Easier to extend and manage</li><li>Failure domain isolated to a network</li><li>Non blocking network fabric</li></ul><p><img alt="Spine & Leaf" loading=lazy src=/images/spineleaf.png></p><h3 id=openshift-managed-load-balancer>OpenShift Managed Load-Balancer<a hidden class=anchor aria-hidden=true href=#openshift-managed-load-balancer>#</a></h3><p>For on-prem platforms (VSphere, Baremetal, OpenStack, Ovirt and Nutanix), the control plane load balancer is based
on HAproxy and Keepalived.
It means that the control plane VIPs (for API & Ingress services) will be managed in Active/Passive mode.
The Keepalived master (elected by VRRPv2) will host the VIPs and therefore all the API & Ingress traffic will always go
through one node and then load-balanced across the control plane. This bottleneck has been an issue at large scale.</p><p>Also, Keepalived doesn&rsquo;t deal with L3 routing, so if the VIPs aren&rsquo;t within the same subnet as the L2 networks,
the network fabric can&rsquo;t know where the VIPs actually are.</p><h3 id=user-managed-load-balancer>User Managed Load-Balancer<a hidden class=anchor aria-hidden=true href=#user-managed-load-balancer>#</a></h3><p>When we initially looked at the limitations of the OpenShift Managed Load-Balancer, we thought we would just add
BGP to the OpenShift control plane, so the VIPs could be routed across the datacenter. You can have a look at this <a href="https://www.youtube.com/watch?v=xLzEBEfxypo">demo</a> that shows how it would work.
After the <a href=https://github.com/shiftstack/enhancements/blob/b54fc17739424c5ef96ffa2e560b527dc4e89230/enhancements/network/on-prem-bgp-networking.md>initial proposal</a>
which brought up a lot of good ideas, it was decided that for now we would rather try to externalize
the Load-Balancer and let the customers dealing with it, rather than implementing something new in OpenShift (I&rsquo;ll come back to it the wrap-up).</p><p>Indeed, a lot of our customers already have (enterprise-grade) load balancers that they use for their workloads. Some of them want to
re-use these appliances and manage the OpenShift control plane traffic with them.</p><p>We realized that some of them want BGP, some of them don&rsquo;t. Some want to keep stretched L2 networks, some don&rsquo;t. There were a lot of
decisions we would make if we would have implemented BGP within the OpenShift control plane so we decided that for now we will
allow to use an external (user-managed) load balancer, like it&rsquo;s already the case for the workloads themselves (e.g. with <a href=https://metallb.universe.tf>MetalLB</a>).</p><p>More details on the design can be found in this <a href=https://github.com/openshift/enhancements/blob/master/enhancements/network/external-lb-vips.md>OpenShift enhancement</a>.</p><h3 id=deploy-your-own-load-balancer>Deploy your own Load-Balancer<a hidden class=anchor aria-hidden=true href=#deploy-your-own-load-balancer>#</a></h3><p>I want to share how someone can deploy a load balancer that will be used by the OpenShift control plane.
For that, I&rsquo;ve decided to create an Ansible role named <a href=https://github.com/EmilienM/ansible-role-routed-lb>ansible-role-routed-lb</a>.</p><p>This will deploy an advanced Load-Balancer capable of managing routed VIPs with FRR (using BGP) and load-balance traffic with HAproxy.</p><p><img alt="Zoom into the LB" loading=lazy src=/images/zoom-lb.png></p><p>The role will do the following:</p><ul><li>If BGP neighbors are provided in the config, it&rsquo;ll deploy FRR and peer with your BGP neighbor(s).
If the VIPs are created on the node, they&rsquo;ll be routed in your infrastructure.</li><li>Deploy HAproxy to load-balance and monitor your service.
If the VIPs are provided in the config, they will be created if a minimum number of backend(s) are
found healthy for a given service, and therefore routed in BGP if FRR is deployed.
They will be removed if no backend was found healthy for a given service, therefore not routed in BGP if FRR is deployed</li></ul><p>So if you&rsquo;re hosting multiple Load-Balancers, your OpenShift control plane traffic will be:</p><ul><li>routed thanks to BGP if FRR is deployed</li><li>load-balanced and high-availability at the VIP level thanks to BGP if FRR is deployed</li><li>load-balanced between healthy backends thanks to HAproxy</li></ul><p>Let&rsquo;s deploy it!</p><p>In this blog post, we won&rsquo;t cover the Failure Domains yet, and will deploy OpenShift within a single Leaf.
Therefore, we&rsquo;ll deploy only one load balancer.</p><p>Create your Ansible <code>inventory.yaml</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>all</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>lb</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible_host</span><span class=p>:</span><span class=w> </span><span class=m>192.168.11.2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible_user</span><span class=p>:</span><span class=w> </span><span class=l>cloud-user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible_become</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></div><p><code>192.168.11.2</code> is the IP address of the load balancer.</p><p>Create the Ansible <code>playbook.yaml</code> file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class=l>lb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>vars</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>config</span><span class=p>:</span><span class=w> </span><span class=l>lb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deploy the LBs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>include_role</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>emilienm.routed_lb</span><span class=w>
</span></span></span></code></pre></div><p>Write the LB configs in Ansible <code>vars.yaml</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>configs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>lb</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>bgp_asn</span><span class=p>:</span><span class=w> </span><span class=m>64998</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>bgp_neighbors</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>ip</span><span class=p>:</span><span class=w> </span><span class=m>192.168.11.1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>password</span><span class=p>:</span><span class=w> </span><span class=l>f00barZ</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>api</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>vips</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=m>192.168.100.240</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>min_backends</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>healthcheck</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;httpchk GET /readyz HTTP/1.0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>balance</span><span class=p>:</span><span class=w> </span><span class=l>roundrobin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>frontend_port</span><span class=p>:</span><span class=w> </span><span class=m>6443</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>haproxy_monitor_port</span><span class=p>:</span><span class=w> </span><span class=m>8081</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>backend_opts</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;check check-ssl inter 1s fall 2 rise 3 verify none&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>backend_port</span><span class=p>:</span><span class=w> </span><span class=m>6443</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>backend_hosts</span><span class=p>:</span><span class=w> </span><span class=cp>&amp;lb_hosts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rack1-10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ip</span><span class=p>:</span><span class=w> </span><span class=m>192.168.11.10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rack1-11</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ip</span><span class=p>:</span><span class=w> </span><span class=m>192.168.11.11</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rack1-12</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ip</span><span class=p>:</span><span class=w> </span><span class=m>192.168.11.12</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rack1-13</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ip</span><span class=p>:</span><span class=w> </span><span class=m>192.168.11.13</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rack1-14</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ip</span><span class=p>:</span><span class=w> </span><span class=m>192.168.11.14</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rack1-15</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ip</span><span class=p>:</span><span class=w> </span><span class=m>192.168.11.15</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rack1-16</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ip</span><span class=p>:</span><span class=w> </span><span class=m>192.168.11.16</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rack1-17</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ip</span><span class=p>:</span><span class=w> </span><span class=m>192.168.11.17</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rack1-18</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ip</span><span class=p>:</span><span class=w> </span><span class=m>192.168.11.18</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rack1-19</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ip</span><span class=p>:</span><span class=w> </span><span class=m>192.168.11.19</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rack1-20</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ip</span><span class=p>:</span><span class=w> </span><span class=m>192.168.11.20</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ingress_http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>vips</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=m>192.168.100.250</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>min_backends</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>healthcheck</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;httpchk GET /healthz/ready HTTP/1.0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>frontend_port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>haproxy_monitor_port</span><span class=p>:</span><span class=w> </span><span class=m>8082</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>balance</span><span class=p>:</span><span class=w> </span><span class=l>roundrobin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>backend_opts</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;check check-ssl port 1936 inter 1s fall 2 rise 3 verify none&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>backend_port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>backend_hosts</span><span class=p>:</span><span class=w> </span><span class=cp>*lb_hosts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ingress_https</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>vips</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=m>192.168.100.250</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>min_backends</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>healthcheck</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;httpchk GET /healthz/ready HTTP/1.0&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>frontend_port</span><span class=p>:</span><span class=w> </span><span class=m>443</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>haproxy_monitor_port</span><span class=p>:</span><span class=w> </span><span class=m>8083</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>balance</span><span class=p>:</span><span class=w> </span><span class=l>roundrobin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>backend_opts</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;check check-ssl port 1936 inter 1s fall 2 rise 3 verify none&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>backend_port</span><span class=p>:</span><span class=w> </span><span class=m>443</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>backend_hosts</span><span class=p>:</span><span class=w> </span><span class=cp>*lb_hosts</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mcs</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>vips</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span>- <span class=m>192.168.100.240</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>min_backends</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>frontend_port</span><span class=p>:</span><span class=w> </span><span class=m>22623</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>haproxy_monitor_port</span><span class=p>:</span><span class=w> </span><span class=m>8084</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>balance</span><span class=p>:</span><span class=w> </span><span class=l>roundrobin</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>backend_opts</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;check check-ssl inter 5s fall 2 rise 3 verify none&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>backend_port</span><span class=p>:</span><span class=w> </span><span class=m>22623</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>backend_hosts</span><span class=p>:</span><span class=w> </span><span class=cp>*lb_hosts</span><span class=w>
</span></span></span></code></pre></div><p>In this case, we deploy OpenShift on OpenStack which doesn&rsquo;t support static IPs. Therefore, we have to put all the available IPs from the subnet used for the machines, in the HAproxy backends.</p><p>Install the role and the dependencies:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ansible-galaxy install emilienm.routed_lb,1.0.0
</span></span><span class=line><span class=cl>ansible-galaxy collection install ansible.posix ansible.utils
</span></span></code></pre></div><p>Deploy the LBs:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ansible-playbook -i inventory.yaml -e <span class=s2>&#34;@vars.yaml&#34;</span> playbook.yaml
</span></span></code></pre></div><h3 id=deploy-openshift>Deploy OpenShift<a hidden class=anchor aria-hidden=true href=#deploy-openshift>#</a></h3><p>This feature will be available in the 4.13 release as TechPreview.</p><p>Here is how you can simply enable it via the <code>install-config.yaml</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>baseDomain</span><span class=p>:</span><span class=w> </span><span class=l>mydomain.test </span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>compute</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>worker</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>platform</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>openstack</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>m1.xlarge</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>controlPlane</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>master</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>platform</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>openstack</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>m1.xlarge</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>mycluster</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>networking</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>clusterNetwork</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>cidr</span><span class=p>:</span><span class=w> </span><span class=m>10.128.0.0</span><span class=l>/14</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>hostPrefix</span><span class=p>:</span><span class=w> </span><span class=m>23</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>machineNetwork</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>cidr</span><span class=p>:</span><span class=w> </span><span class=m>192.168.11.0</span><span class=l>/24</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>cidr</span><span class=p>:</span><span class=w> </span><span class=m>192.168.100.0</span><span class=l>/24</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>platform</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>openstack</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>cloud</span><span class=p>:</span><span class=w> </span><span class=l>mycloud</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>machinesSubnet</span><span class=p>:</span><span class=w> </span><span class=l>8586bf1a-cc3c-4d40-bdf6-c243decc603a</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>apiVIPs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>192.168.100.240</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ingressVIPs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=m>192.168.100.250</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>loadBalancer</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>UserManaged</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>featureSet</span><span class=p>:</span><span class=w> </span><span class=l>TechPreviewNoUpgrade</span><span class=w>
</span></span></span></code></pre></div><p>You can also watch this <a href=https://youtu.be/P05420tNJYI>demo</a> which shows the outcome.</p><h3 id=known-limitations>Known limitations<a hidden class=anchor aria-hidden=true href=#known-limitations>#</a></h3><ul><li>Deploying OpenShift with static IPs for the machines is only supported on Baremetal platform for now but it&rsquo;s in the roadmap to support it on
VSphere and OpenStack as well.</li><li>Changing the IP address for any OpenShift control plane VIP (API + Ingress) is currently not supported. So once the external LB and the OpenShift
cluster is deployed, the VIPs can&rsquo;t be changed. This is in our roadmap.</li><li>Migrating an OpenShift cluster from the OpenShift managed LB to an external LB is currently not supported. It&rsquo;s in our roadmap as well.</li></ul><p>Keep in mind that the feature will be TechPreview at first and once it has reached some maturity, we&rsquo;ll promote it to GA.</p><h3 id=wrap-up>Wrap-up<a hidden class=anchor aria-hidden=true href=#wrap-up>#</a></h3><p>Having the VIPs highly available, routed across multiple domains is only a first step into distributing the OpenShift control plane.
In the future, we&rsquo;ll discuss about how Failure Domains will be configured when deploying OpenShift on OpenStack. Note that this is already
doable on Baremetal and Vsphere.</p><p>With this effort, our customers can now decide which Load-Balancer to use, and if they have some expertise in their appliance now they can use it
for the OpenShift control plane.</p><p>The way we implemented it is flexible and will allow us to implement new load balancers in OpenShift if we want to in the future.
The proof of concept done a few months ago with BGP in the control plane could be restored if there is growing interest.</p><p>I hope you liked this article and stay tuned for the next ones!</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://my1.fr/blog/openshift-external-load-balancer-control-plane-with-failure-domains/><span class=title>« Prev</span><br><span>Deploying OpenShift on OpenStack with an External Load-Balancer for your control plane in multiple Failure Domains</span>
</a><a class=next href=https://my1.fr/blog/sriov-network-operator-improvements-openstack/><span class=title>Next »</span><br><span>SR-IOV network operator improvements for OpenStack</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploying OpenShift with an External Load-Balancer for your control plane on x" href="https://x.com/intent/tweet/?text=Deploying%20OpenShift%20with%20an%20External%20Load-Balancer%20for%20your%20control%20plane&amp;url=https%3a%2f%2fmy1.fr%2fblog%2fopenshift-external-load-balancer-control-plane-intro%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploying OpenShift with an External Load-Balancer for your control plane on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fmy1.fr%2fblog%2fopenshift-external-load-balancer-control-plane-intro%2f&amp;title=Deploying%20OpenShift%20with%20an%20External%20Load-Balancer%20for%20your%20control%20plane&amp;summary=Deploying%20OpenShift%20with%20an%20External%20Load-Balancer%20for%20your%20control%20plane&amp;source=https%3a%2f%2fmy1.fr%2fblog%2fopenshift-external-load-balancer-control-plane-intro%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploying OpenShift with an External Load-Balancer for your control plane on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fmy1.fr%2fblog%2fopenshift-external-load-balancer-control-plane-intro%2f&title=Deploying%20OpenShift%20with%20an%20External%20Load-Balancer%20for%20your%20control%20plane"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploying OpenShift with an External Load-Balancer for your control plane on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmy1.fr%2fblog%2fopenshift-external-load-balancer-control-plane-intro%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploying OpenShift with an External Load-Balancer for your control plane on whatsapp" href="https://api.whatsapp.com/send?text=Deploying%20OpenShift%20with%20an%20External%20Load-Balancer%20for%20your%20control%20plane%20-%20https%3a%2f%2fmy1.fr%2fblog%2fopenshift-external-load-balancer-control-plane-intro%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploying OpenShift with an External Load-Balancer for your control plane on telegram" href="https://telegram.me/share/url?text=Deploying%20OpenShift%20with%20an%20External%20Load-Balancer%20for%20your%20control%20plane&amp;url=https%3a%2f%2fmy1.fr%2fblog%2fopenshift-external-load-balancer-control-plane-intro%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Deploying OpenShift with an External Load-Balancer for your control plane on ycombinator" href="https://news.ycombinator.com/submitlink?t=Deploying%20OpenShift%20with%20an%20External%20Load-Balancer%20for%20your%20control%20plane&u=https%3a%2f%2fmy1.fr%2fblog%2fopenshift-external-load-balancer-control-plane-intro%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><div id=disqus_thread></div><script>(function(){var e=document,t=e.createElement("script");t.src="https://emilien-blog.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></article></main><footer class=footer><span>&copy; 2025 <a href=https://my1.fr/>/home/emilien</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>